<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

	<div th:fragment="product-item(p)" class="product-item">

		<div class="product-image">
			<div class="badge-new" th:if="${p.isNew}">NEW</div>

			<a th:id="'product-link-' + ${p.id}"
				th:href="@{/product/{id}(id=${p.id})}"> <th:block
					th:if="${not #lists.isEmpty(p.productColors)}">
					<th:block th:with="firstColor=${p.productColors[0]}">

						<img th:id="'img-main-' + ${p.id}"
							th:if="${not #lists.isEmpty(firstColor.images)}"
							th:src="@{'/uploads/' + ${firstColor.images[0].imageUrl}}"
							class="img-main">

						<img th:id="'img-hover-' + ${p.id}"
							th:if="${firstColor.images.size() > 1}"
							th:src="@{'/uploads/' + ${firstColor.images[1].imageUrl}}"
							class="img-hover">

						<img th:id="'img-hover-' + ${p.id}"
							th:if="${firstColor.images.size() == 1}"
							th:src="@{'/uploads/' + ${firstColor.images[0].imageUrl}}"
							class="img-hover">
					</th:block>
				</th:block> <img th:if="${#lists.isEmpty(p.productColors)}"
				src="https://via.placeholder.com/300x450?text=No+Image"
				class="img-main">
			</a>
		</div>

		<div class="product-info">

			<div class="info-row-1">
				<div class="list-colors" style="display: flex; gap: 5px;">
					<th:block th:if="${not #lists.isEmpty(p.productColors)}">
						<th:block th:each="pc, iter : ${p.productColors}">

							<div th:if="${pc.isActive and not #lists.isEmpty(pc.images)}"
								class="color-dot-wrapper" style="cursor: pointer;"
								th:data-id="${p.id}" th:data-color="${pc.color.name}"
								th:data-img="@{'/uploads/' + ${pc.images[0].imageUrl}}"
								th:data-hover="@{'/uploads/' + ${pc.images.size() > 1 ? pc.images[1].imageUrl : pc.images[0].imageUrl}}"
								onclick="changeProductImage(this.getAttribute('data-id'), this.getAttribute('data-img'), this.getAttribute('data-hover'), this.getAttribute('data-color'), this)"
								th:title="${pc.color.name}">

								<span class="color-dot"
									th:classappend="${iter.index == 0} ? 'active'"
									th:style="'background-color:' + ${pc.color.hexCode}"> </span>
							</div>

						</th:block>
					</th:block>
				</div>

				<button class="btn-wishlist">
					<i class="far fa-heart"></i>
				</button>
			</div>

			<div class="product-title">
				<a th:href="@{/product/{id}(id=${p.id})}" th:text="${p.name}">
					Tên sản phẩm </a>
			</div>

			<div class="info-row-bottom" style="position: relative;">
				<div class="product-price">
					<span
						th:text="${#numbers.formatDecimal(p.basePrice, 0, 'POINT', 0, 'COMMA')} + 'đ'">
						990.000đ </span>
				</div>
				<a href="javascript:void(0)" class="btn-bag-black"
					th:onclick="'toggleSizeList(' + ${p.id} + ', event)'"> <i
					class="fas fa-shopping-bag"></i>
				</a>
				<div th:id="'size-list-' + ${p.id}" class="quick-size-popup">
					<ul th:if="${not #lists.isEmpty(p.productColors)}">
						<li th:each="variant : ${p.productColors[0].variants}"
							th:if="${variant.stock > 0}" th:text="${variant.size.name}"
							th:onclick="'quickAddToCart(' + ${variant.id} + ')'">S</li>
					</ul>
				</div>
			</div>

		</div>
	</div>

</body>
</html>