<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{client/layout}">
<head>
<title>Đăng ký tài khoản - IVY moda</title>
</head>
<body>
	<div layout:fragment="content">
		<div class="container-ivy"
			style="margin-top: 50px; margin-bottom: 50px;">

			<h3 class="text-center font-weight-bold mb-5"
				style="font-size: 24px;">ĐĂNG KÝ</h3>

			<div th:if="${errorMessage}"
				class="alert alert-danger alert-dismissible fade show mb-4"
				role="alert">
				<i class="fas fa-exclamation-triangle mr-2"></i> <span
					th:text="${errorMessage}">Lỗi đăng ký</span>
				<button type="button" class="close" data-dismiss="alert"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<form th:action="@{/register}" method="post" th:object="${userDto}">
				<div class="row">

					<div class="col-md-6 col-12 px-4">
						<h5 class="font-weight-bold mb-4" style="font-size: 16px;">Thông
							tin khách hàng</h5>

						<div class="row">
							<div class="col-md-6 mb-3">
								<label class="auth-label">Họ:<span class="text-danger">*</span></label>
								<input type="text" name="lastName" class="form-control-ivy"
									placeholder="Họ...">
							</div>
							<div class="col-md-6 mb-3">
								<label class="auth-label">Tên:<span class="text-danger">*</span></label>
								<input type="text" name="firstName" class="form-control-ivy"
									placeholder="Tên...">
							</div>
						</div>

						<div class="row">
							<div class="col-md-6 mb-3">
								<label class="auth-label">Email:<span
									class="text-danger">*</span></label> <input type="email" name="email"
									class="form-control-ivy" placeholder="Email...">
							</div>
							<div class="col-md-6 mb-3">
								<label class="auth-label">Điện thoại:<span
									class="text-danger">*</span></label> <input type="text"
									name="phoneNumber" class="form-control-ivy"
									placeholder="Điện thoại...">
							</div>
						</div>

						<div class="row">
							<div class="col-md-6 mb-3">
								<label class="auth-label">Ngày sinh:<span
									class="text-danger">*</span></label> <input type="date" name="dob"
									class="form-control-ivy">
							</div>
							<div class="col-md-6 mb-3">
								<label class="auth-label">Giới tính:<span
									class="text-danger">*</span></label> <select name="gender"
									class="form-control-ivy">
									<option value="nu">Nữ</option>
									<option value="nam">Nam</option>
									<option value="khac">Khác</option>
								</select>
							</div>
						</div>

<div class="row">
    <div class="col-md-6 mb-3">
        <label class="auth-label">Tỉnh/TP:<span class="text-danger">*</span></label> 
        <select id="provinceSelect" name="city" class="form-control-ivy" required>
            <option value="">Chọn Tỉnh/Tp</option>
        </select>
    </div>
    <div class="col-md-6 mb-3">
        <label class="auth-label">Quận/Huyện:<span class="text-danger">*</span></label> 
        <select id="districtSelect" name="district" class="form-control-ivy" required>
            <option value="">Chọn Quận/Huyện</option>
        </select>
    </div>
</div>

<div class="form-group mb-3">
    <label class="auth-label">Phường/Xã:<span class="text-danger">*</span></label> 
    <select id="wardSelect" name="ward" class="form-control-ivy" required>
        <option value="">Chọn Phường/Xã</option>
    </select>
</div>

						<div class="form-group mb-3">
							<label class="auth-label">Địa chỉ:<span
								class="text-danger">*</span></label>
							<textarea name="detailAddress" class="form-control-ivy" rows="2"
								placeholder="Địa chỉ chi tiết..."></textarea>
						</div>
					</div>

					<div class="col-md-6 col-12 px-4">
						<h5 class="font-weight-bold mb-4" style="font-size: 16px;">Thông
							tin mật khẩu</h5>

						<div class="form-group mb-3">
							<label class="auth-label">Mật khẩu:<span
								class="text-danger">*</span></label> <input type="password"
								name="password" class="form-control-ivy"
								placeholder="Mật khẩu...">
						</div>

						<div class="form-group mb-3">
							<label class="auth-label">Nhập lại mật khẩu:<span
								class="text-danger">*</span></label> <input type="password"
								name="confirmPassword" class="form-control-ivy"
								placeholder="Nhập lại mật khẩu...">
						</div>

						<div class="form-group mb-3">
							<label class="auth-label">Mã xác thực:<span
								class="text-danger">*</span></label>
							<div class="d-flex align-items-center">
								<input type="text" class="form-control-ivy mr-3"
									style="width: 50%;">
								<div
									style="background: #eee; padding: 8px 15px; font-weight: bold; letter-spacing: 5px; font-family: monospace; border: 1px solid #ccc;">
									W j 4 5</div>
							</div>
						</div>

						<div class="custom-control custom-checkbox mb-2">
							<input type="checkbox" class="custom-control-input"
								id="termAgree" required> <label
								class="custom-control-label small text-muted" for="termAgree">
								Đồng ý với các <a href="#" class="text-danger">điều khoản</a>
								của IVY
							</label>
						</div>
						<div class="custom-control custom-checkbox mb-4">
							<input type="checkbox" class="custom-control-input"
								id="newsAgree"> <label
								class="custom-control-label small text-muted" for="newsAgree">
								Đăng ký nhận bản tin </label>
						</div>

						<button type="submit" class="btn-auth-action">ĐĂNG KÝ</button>
					</div>

				</div>
			</form>
		</div>
	</div>
	
	
	
	<th:block layout:fragment="pageScripts">
   <script>
    document.addEventListener("DOMContentLoaded", function () {
        const provinceSelect = document.getElementById('provinceSelect');
        const districtSelect = document.getElementById('districtSelect');
        const wardSelect = document.getElementById('wardSelect');

        // 1. Lấy danh sách Tỉnh/Thành phố
        fetch('https://provinces.open-api.vn/api/?depth=1')
            .then(response => response.json())
            .then(data => {
                data.forEach(province => {
                    let option = new Option(province.name, province.name);
                    option.dataset.code = province.code; // Lưu mã code để lấy quận huyện
                    provinceSelect.add(option);
                });
            });

        // 2. Khi chọn Tỉnh -> Lấy Quận/Huyện
        provinceSelect.addEventListener('change', function () {
            districtSelect.innerHTML = '<option value="">Chọn Quận/Huyện</option>';
            wardSelect.innerHTML = '<option value="">Chọn Phường/Xã</option>';
            
            const selectedOption = this.options[this.selectedIndex];
            const provinceCode = selectedOption.dataset.code;

            if (provinceCode) {
                fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`)
                    .then(response => response.json())
                    .then(data => {
                        data.districts.forEach(district => {
                            let option = new Option(district.name, district.name);
                            option.dataset.code = district.code;
                            districtSelect.add(option);
                        });
                    });
            }
        });

        // 3. Khi chọn Quận -> Lấy Phường/Xã
        districtSelect.addEventListener('change', function () {
            wardSelect.innerHTML = '<option value="">Chọn Phường/Xã</option>';
            
            const selectedOption = this.options[this.selectedIndex];
            const districtCode = selectedOption.dataset.code;

            if (districtCode) {
                fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`)
                    .then(response => response.json())
                    .then(data => {
                        data.wards.forEach(ward => {
                            let option = new Option(ward.name, ward.name);
                            wardSelect.add(option);
                        });
                    });
            }
        });
    });
</script>
</th:block>
	
	
	
</body>
</html>